---
# tasks file for docker
- name: Install docker required packages
  yum:
    name: ['yum-utils', 'device-mapper-persistent-data', 'lvm2']
    state: latest


# Download the repo file from the official site, and put it in the default 
# repo position, with the correct permissions.
- name: Add docker repo
  get_url:
    url: "https://download.docker.com/linux/centos/docker-ce.repo"
    dest: "/etc/yum.repos.d/docker-ce.repo"
    mode: 0644

# Install docker
- name: "Installing Docker latest version"
  yum:
    name: "docker-ce"
    state: present
  notify: start-docker


# Copy configuration file to enable REST API via TCP
#- name: Enable REST API
#  template:
#    src: docker.service.j2
#    dest: /lib/systemd/system/docker.service
#    mode: '0600'
#    force: yes
#  notify: restart-daemon

# Force to flush handlers, so it will restart daemon from the task above
- meta: flush_handlers

  # Restart docker to load configuration 
- name: Restart docker
  service:
    name: docker
    state: restarted